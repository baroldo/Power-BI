CustomerPercentile = 
VAR ThisGroup =
    COALESCE(
        SELECTEDVALUE('MARGIN_DECILIES'[INDUSTRY]),
        SELECTEDVALUE('MARGIN_DECILIES'[PROD_CAT]),
        SELECTEDVALUE('MARGIN_DECILIES'[SECTOR_DESC]),
        "All"
    )

VAR GroupedTable =
    ADDCOLUMNS(
        ALLSELECTED('MARGIN_DECILIES'),
        "TempGroup", ThisGroup,
        "CustomerMargin", CALCULATE(SUM('MARGIN_DECILIES'[CustomerPercentileRankIncremental]))
    )

RETURN
    ROUND(
        DIVIDE(
            RANKX(
                FILTER(GroupedTable, [TempGroup] = ThisGroup),
                [CustomerMargin],
                ,
                DESC,
                Dense
            ),
            COUNTROWS(FILTER(GroupedTable, [TempGroup] = ThisGroup))
        ) * 100,
        0
    )
