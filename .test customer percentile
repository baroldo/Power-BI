CustomerPercentile = 
VAR ThisGroup =
    SWITCH(
        TRUE(),
        ISINSCOPE('MARGIN_DECILIES'[INDUSTRY]),     'MARGIN_DECILIES'[INDUSTRY],
        ISINSCOPE('MARGIN_DECILIES'[PROD_CAT]),     'MARGIN_DECILIES'[PROD_CAT],
        ISINSCOPE('MARGIN_DECILIES'[SECTOR_DESC]),  'MARGIN_DECILIES'[SECTOR_DESC],
        "All"
    )

VAR GroupedTable =
    ADDCOLUMNS(
        ALLSELECTED('MARGIN_DECILIES'),
        "GroupValue", ThisGroup,
        "CustomerMargin", CALCULATE(SUM('MARGIN_DECILIES'[CustomerPercentileRankIncremental]))
    )

VAR ThisCustomerMargin = CALCULATE(SUM('MARGIN_DECILIES'[CustomerPercentileRankIncremental]))

RETURN
    ROUND(
        DIVIDE(
            RANKX(
                FILTER(GroupedTable, [GroupValue] = ThisGroup),
                [CustomerMargin],
                ,
                DESC,
                Dense
            ),
            COUNTROWS(FILTER(GroupedTable, [GroupValue] = ThisGroup))
        ) * 100,
        0
    )
