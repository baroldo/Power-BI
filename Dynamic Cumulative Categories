DynamicCumulativeMarginPercent =
VAR CurrentPercentile = MAX('PercentileAxis'[Percentage of Merchants (%)])

-- All base data (filtered by report visuals and slicers)
VAR BaseData = 
    ALLSELECTED(MARGIN_DECILIES)

-- Get values of the current selected group (e.g. Region names, or Categories)
VAR GroupValues = 
    VALUES('GroupBySelector'[GroupBySelector])

-- Virtual table of only data in the selected group values
VAR GroupedData =
    CALCULATETABLE(
        MARGIN_DECILIES,
        TREATAS(GroupValues, 'GroupBySelector'[GroupBySelector])
    )

-- Add customer-level margin
VAR CustomerMargins =
    ADDCOLUMNS(
        GroupedData,
        "Margin", MARGIN_DECILIES[MARGIN_$]
    )

-- Add percentile rank within this group
VAR RankedTable =
    ADDCOLUMNS(
        CustomerMargins,
        "CustomerPercentile",
        ROUND(
            DIVIDE(
                RANKX(CustomerMargins, [Margin], , DESC, DENSE),
                COUNTROWS(CustomerMargins)
            ) * 100,
            0
        )
    )

-- Cumulative margin up to selected percentile
VAR CumulativeMargin =
    SUMX(
        FILTER(RankedTable, [CustomerPercentile] <= CurrentPercentile),
        [Margin]
    )

-- Total margin for the group
VAR TotalMargin =
    SUMX(RankedTable, [Margin])

RETURN
    DIVIDE(CumulativeMargin, TotalMargin)