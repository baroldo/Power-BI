DynamicCumulativeMarginPercent = 
VAR CurrentPercentile = MAX('PercentileAxis'[Percentage of Merchants (%)])

-- Step 1: Table in current visual & slicer context
VAR RankedTable =
    ADDCOLUMNS(
        ALLSELECTED(MARGIN_DECILIES),
        "Margin", MARGIN_DECILIES[MARGIN_$]
    )

-- Step 2: Rank within visual context (which includes the group â€” from the legend)
VAR RankedWithPercentile =
    ADDCOLUMNS(
        RankedTable,
        "CustomerPercentile",
        ROUND(
            DIVIDE(
                RANKX(
                    RankedTable,
                    [Margin],
                    ,
                    DESC,
                    DENSE
                ),
                COUNTROWS(RankedTable)
            ) * 100,
            0
        )
    )

-- Step 3: Cumulative margin up to current percentile
VAR CumulativeMargin =
    SUMX(
        FILTER(
            RankedWithPercentile,
            [CustomerPercentile] <= CurrentPercentile
        ),
        [Margin]
    )

-- Step 4: Total margin in group (visual context)
VAR TotalMargin =
    SUMX(RankedWithPercentile, [Margin])

RETURN
    DIVIDE(CumulativeMargin, TotalMargin)