DynamicCumulativeMarginPercent = 
VAR CurrentPercentile = MAX('PercentileAxis'[Value])

-- Get the current legend grouping from the visual (could be Category, Segment, etc.)
VAR CurrentGroupValue = SELECTEDVALUE('GroupBySelector'[GroupBySelector])

-- Table of customers WITHIN the current group (legend item), respecting slicers
VAR CustomersInGroup =
    ALLSELECTED('YourTable')

-- Summarize customer-level margin
VAR CustomerMargins =
    ADDCOLUMNS(
        CustomersInGroup,
        "Margin", SUM('YourTable'[MARGIN_$])
    )

-- Rank customers within this group by margin
VAR RankedTable =
    ADDCOLUMNS(
        CustomerMargins,
        "CustomerPercentile",
        ROUND(
            DIVIDE(
                RANKX(CustomerMargins, [Margin], , DESC, DENSE),
                COUNTROWS(CustomerMargins)
            ) * 100,
            0
        )
    )

-- Cumulative margin up to this percentile
VAR CumulativeMargin =
    SUMX(
        FILTER(RankedTable, [CustomerPercentile] <= CurrentPercentile),
        [Margin]
    )

-- Total margin for this group
VAR TotalMargin =
    SUMX(RankedTable, [Margin])

RETURN
    DIVIDE(CumulativeMargin, TotalMargin)